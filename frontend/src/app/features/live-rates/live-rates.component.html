<section>
  <div class="card shadow-sm">
    <div class="card-header bg-white d-flex flex-wrap gap-2 align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-2">
        <span class="badge text-bg-primary rounded-pill">LIVE</span>
        <h2 class="h5 m-0">Exchange Rates</h2>
      </div>
      @if (lastDate()) {
        <span class="text-body-secondary small">Last update: {{ lastDate() }}</span>
      }
    </div>

    <div class="card-body pt-3">
      @if (loading()) {
        <div class="text-center py-4 text-body-secondary">Loading latest rates…</div>
      }
      @if (error(); as err) {
        <div class="alert alert-danger" role="alert">{{ err }}</div>
      }
      @if (!loading() && !error() && rates().length === 0) {
        <div class="text-center py-4 text-body-secondary">No rates available.</div>
      }

      @if (!loading() && !error() && rates().length > 0) {
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="text-nowrap">Currency</th>
                <th class="text-end text-nowrap">Official</th>
                <th class="text-end text-nowrap">Buy</th>
                <th class="text-end text-nowrap">Sell</th>
                <th class="text-nowrap d-none d-md-table-cell">Last Update</th>
                <th class="text-end text-nowrap">Change (24h)</th>
              </tr>
            </thead>
            <tbody>
              @for (r of rates(); track r.code; let i = $index) {
                <tr>
                  <td class="text-nowrap">
                    <div class="d-flex align-items-center gap-2">
                      <span class="fw-semibold">{{ r.code }}</span>
                      <span class="text-body-secondary small">{{ r.name }}</span>
                    </div>
                  </td>
                  <td class="text-end">{{ r.officialRate | number:'1.2-2' }}</td>
                  <td class="text-end">{{ r.buyRate | number:'1.2-2' }}</td>
                  <td class="text-end">{{ r.sellRate | number:'1.2-2' }}</td>
                  <td class="text-nowrap d-none d-md-table-cell">{{ lastDate() ?? '-' }}</td>
                  <td class="text-end">
                    @if (r.change24h) {
                      <span class="badge align-middle"
                            [class.text-bg-success]="(r.change24h + '').startsWith('+')"
                            [class.text-bg-danger]="(r.change24h + '').startsWith('-')">
                        {{ (r.change24h + '').startsWith('+') ? '▲' : ((r.change24h + '').startsWith('-') ? '▼' : '') }}
                        {{ r.change24h }}
                      </span>
                    } @else {
                      <span class="text-body-secondary">-</span>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>
</section>
